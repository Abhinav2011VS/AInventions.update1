var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))};define("clientinst_xls",["require","exports"],function(n,t){function gi(){function n(n,t){typeof i[n]=="undefined"&&(i[n]=t)}_w.ClientInstConfig||(_w.ClientInstConfig={});i=ClientInstConfig;n("flushInterval",5e3);n("retryInterval",1e3);n("maxStorageUse",5e5);n("maxBatchSize",1e5);n("queueDumpInterval",500);n("waitForPageInfo",!1);n("pageInfoTimeout",5e3);n("logUploadCapSizeInChar",15728640*.5);n("logUploadCapIntervalInDays",30);n("isInstrumentationEnabled",!0);n("maxDirectErrors",3);n("enableBatSizeError",!1)}function bt(){ut=0;ft=_G.ST?_G.ST.getTime():0}function u(n,t,r,u){var f,h,e,o;if(i.isInstrumentationEnabled)if(f={errorType:n,failCount:t},k(f),u){wt++;wt>i.maxDirectErrors&&(f.errorType="Overloaded",i.isInstrumentationEnabled=!1);h={impressionGuid:r,previousImpressionGuid:null,timestamp:(new Date).getTime(),type:s.EVENT,data:{eventType:rt,eventData:f}};e=st([h],[]);try{at(e)||(o=sj_gx(),o.open("POST",_G.XLS,!0),o.send(e))}catch(c){throw c;}}else lt(rt,f,null,null,null,r,null,null)}function nr(){function t(){o||(o=function(){});kt();u("PageInfoTimedOut",0,_G.IG)}gi();bt();typeof h!="undefined"&&h.bind&&h.bind("ajax.unload",bt);try{f=_w.localStorage;r.initialize()}catch(e){}var n=null;i.waitForPageInfo&&(n=sb_st(t,i.pageInfoTimeout));sj_evt.bind("ClientInst.PageInstInfo",function(t){n&&(sb_ct(n),n=null);o=t[1];o&&kt()})}function kt(){for(var n=0,t,i;et.length>0;){try{i=et.shift();t=JSON.parse(i)}catch(r){n++;continue}o&&o(t.data);w(t)}n>0&&u("InvalidIncompleteImpressions",n,_G.IG)}function w(n){r.append(n);l()}function a(n){return JSON.stringify(n).replace(/]]>/g,"]]]\]><![CDATA[>")}function tr(n,t,i){var e,r,u,f;t.push("<E>","<T>Event.",n.data.eventType,"<\/T>","<IG>",n.impressionGuid,"<\/IG>");n.previousImpressionGuid&&t.push("<PrevIG>",n.previousImpressionGuid,"<\/PrevIG>");n.dominantImpressionGuid&&n.previousImpressionGuid&&t.push("<DominantIG>",n.dominantImpressionGuid,"<\/DominantIG>");e=n.data.dataSources;e&&t.push("<DS><![CDATA[",a(e),"]\]><\/DS>");r=n.data.pageLayout;r&&y(r)&&(t.push("<Page>"),u=!1,"Name"in r&&(t.push("<Name>",r.Name,"<\/Name>"),u=!0),"Number"in r&&(t.push("<Num>",r.Number,"<\/Num>"),u=!0),"IID"in r&&(t.push("<IID>",r.IID,"<\/IID>"),u=!0),"SFX"in r&&(t.push("<SFX>",r.SFX,"<\/SFX>"),u=!0),u&&(r=r.L),t.push("<L><![CDATA[",a(r),"]\]><\/L>","<\/Page>"));f=n.data.eventData;f||(f=n.data.eventData={});f.UTS=i;t.push("<D><![CDATA[",a(f),"]\]><\/D>","<TS>",n.timestamp,"<\/TS>","<\/E>")}function y(n){var t=!1,i;try{if(n instanceof Array)t=n.every(y);else{if(i=n.L,n.Name||n.Number||n.InsertId||n.SFX)return y(i);t=!!n.T;t&&i&&(t=y(i))}}catch(r){return SharedLogHelper.LogWarning("PageLayoutValidationException",null,r),!1}return t||SharedLogHelper.LogWarning("PageLayoutValidationException",JSON?JSON.stringify(n):n,null),t}function b(n,t,i){n.push('<requestInfo key="',t,'" value="',i,'"/>')}function ir(n,t,i){function f(n){return n?n.replace(/&/g,"&amp;").replace(/"/g,"&quot;"):""}var r=n.data,e,u,c,o,s,h;t.push("<Group>","<M>","<IG>",n.impressionGuid,"<\/IG>","<DS><![CDATA[",a(r.dataSources),"]\]><\/DS>");e=r.enrichedClientInfo;e||(e={});e.ImpressionUrl=r.impressionUrl;_G.AppVer&&(e.ResourcesVersion=_G.AppVer);u=n.data.eventData;u||(u=n.data.eventData={});u.EnrichedClientInfo=e;u.TS=r.clientTimestamp;u.UTS=i;c=r.uxClassification;c&&(u.UxClassification=c);_w.sj_cook&&sj_cook.parse&&(u.Cookies=sj_cook.parse());t.push("<D><![CDATA[",a(u),"]\]><\/D>");t.push("<Page>","<Name>",r.pageName,"<\/Name>");o=r.layoutNodes;o&&y(o)&&t.push("<L><![CDATA[",a(o),"]\]><\/L>");t.push("<\/Page>","<TS>",n.timestamp,"<\/TS>","<Ovr>");b(t,"RawQuery",f(r.rawQuery));b(t,"IsQuery",f(r.isQuery.toString()));b(t,"Form",f(r.form));s=r.userInfoOverrides;for(h in s)s.hasOwnProperty(h)&&b(t,f(h),f(s[h]));t.push('<userInfo key="AppName" value="',f(r.appName),'"/>',"<\/Ovr>","<\/M>","<\/Group>")}function k(n){var t=window.location.href,i,r,u;return v&&t.indexOf(v)===0||(i=t.indexOf("?"),i<0&&(i=t.indexOf("#")),v=i<0?t:t.substring(0,i),r=_w.ThresholdUtilities,r&&(u=r.getUrlParameter(t,"FORM"),u&&(v+="?FORM="+u))),n.CurUrl=v,n.Pivot=_G.PN,typeof ThresholdUtilities!="undefined"&&_w.SearchAppWrapper&&_w.SearchAppWrapper.CortanaApp&&ThresholdUtilities.getCortanaHeaders(function(t){if(t){var i;(i=t["X-BM-ClientFeatures"])&&(n.CF=i);(i=t["X-BM-FlightedFeatures"])&&(n.FF=i)}}),n}function st(n,t,i){var f,s,h,u,c;i===void 0&&(i=!1);var r=["<ClientInstRequest>"],e=(new Date).getTime(),o=_G.CID||sj_cook.get(yt,yt);if(o&&r.push("<CID>",o,"<\/CID>"),n.length>0){for(i&&(f=n[0],f.data&&f.data.pageLayout&&f.data.pageLayout.IID&&f.data.pageLayout.SFX&&(s=f.data.pageLayout.IID+"_"+f.data.pageLayout.SFX,r.push("<AppNS>",s,"<\/AppNS>"))),r.push("<Events>"),u=0;u<n.length;u++)h=n[u],tr(h,r,e);r.push("<\/Events>")}if(t.length>0)for(u=0;u<t.length;u++)c=t[u],ir(c,r,e);return r.push("<\/ClientInstRequest>"),r.join("")}function l(n,t){if(n===void 0&&(n=!1),t===void 0&&(t=!0),i.isInstrumentationEnabled){var r=n?c.retryQueue:c.mainQueue;!r.flushTimeoutHandle&&typeof tt!="undefined"&&tt.setTimeout&&(r.flushTimeoutHandle=tt.setTimeout(function(){return dt(n,r,!1,t)},r.getInterval()))}}function dt(n,t,f,o,s){var it,v,h,p,g,w,b,nt,k,y,d,rt,a,tt;if((o===void 0&&(o=!0),i.isInstrumentationEnabled)&&(sb_ct(t.flushTimeoutHandle),t.flushTimeoutHandle=null,!n||!c.mainQueue.inProgressUpload)){if(!n&&c.retryQueue.inProgressUpload&&c.retryQueue.inProgressUpload.abort(),t.inProgressUpload)if(it=(new Date).getTime()-t.requestSentTimestamp,f||it>i.flushInterval)t.inProgressUpload.abort(),f?u("SendAbortedForceFlush",1,_G.IG):u("SendTimedOut",1,_G.IG);else return;if(v=r.getBatch(n),v.length!=0){for(h={},p=0;p<v.events.length;p++)g=v.events[p],w=g.flights,h[w]||(h[w]={events:[],mpis:[]}),h[w].events.push(g.log);for(b=0;b<v.masterPageImpressions.length;b++)nt=v.masterPageImpressions[b],k=nt.flights,h[k]||(h[k]={events:[],mpis:[]}),h[k].mpis.push(nt.log);for(y in h){if(d=st(h[y].events,h[y].mpis),rt=s&&s.useSendBeacon||!1,(rt||ei())&&oi(_G.XLS,d)){r.clearSentItems(n)&&!n&&l(!1,s);l(!0,s);continue}a=sj_gx();a.open("POST",_G.XLS,o);tt=sj_df(rr,a,t,n);o&&(i.flushInterval>=1e3&&(a.timeout=i.flushInterval),a.onload=tt);a.setRequestHeader("Content-type","text/xml");y!==""&&(a.setRequestHeader("X-MSEdge-ExternalExpType","JointCoord"),a.setRequestHeader("X-MSEdge-ExternalExp",y));t.inProgressUpload=a;t.requestSentTimestamp=(new Date).getTime();a.send(d);o||tt(null)}}}}function rr(n,t,i,u){if(t.readyState===4){i.inProgressUpload=null;var f=Math.floor(t.status/100);f===2?(r.clearSentItems(u)&&!u&&l(!1),l(!0)):f===4?(r.markFailedItems(!0,u),l(!0)):r.markFailedItems(!1,u);u&&r.recordRetryAttempt()}}function gt(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=!0);dt(!1,c.mainQueue,n,t,i)}function ht(n,t,i,r,u,f,e,o,h){var c={},l,a;if(k(c),t)if(typeof t=="string")c.Text=t;else for(l in t)t.hasOwnProperty(l)&&(c[l]=t[l]);return i&&(c.T="CI."+i),a=h||(new Date).getTime(),c.TS=a,c.RTS=a-ft,c.SEQ=ut++,{type:s.EVENT,impressionGuid:f!=null?f:_G.IG,previousImpressionGuid:e,timestamp:a,data:{eventType:n,eventData:c,dataSources:r,pageLayout:u},dominantImpressionGuid:o}}function ct(n,t){var r,i;t===void 0&&(t=!1);r=st(n,[],t);at(r)||(i=sj_gx(),i.open("POST",_G.XLS),i.setRequestHeader("Content-type","text/xml"),i.send(r))}function lt(n,t,r,u,f,e,o,s,h){var c,l,a;if(typeof EventsToDuplicate!="undefined"&&EventsToDuplicate&&n==="Click"&&EventsToDuplicate.indexOf("duplicateClickOnLs")>=0&&(c=_G.gpUrl+"IG="+_G.IG+"&ID="+t.AppNS+","+t.K,at("",c)||(_G.GPImg=new Image,_G.GPImg.src=c),n="XlsDelayedClick"),!_G.XLS)throw new Error("_G.XLS is necessary for clientinst_xls, but it is not defined");if(i.isInstrumentationEnabled){if(l=ht(n,t,r,u,f,e,o,s,h),n==="PartialDynamicContent.FrontDoor"){ct([l],!0);return}typeof EventsToDuplicate!="undefined"&&EventsToDuplicate&&(EventsToDuplicate.indexOf("ALL")>=0||EventsToDuplicate.indexOf(n)>=0)&&(a=ht("Immediate"+n,t,r,u,f,e,o,s,h),ct([a]));w(l)}}function ni(n){var t,r,u;i.isInstrumentationEnabled&&(o&&o(n),n.clientTimestamp||(n.clientTimestamp=(new Date).getTime()),t=n.eventData,t||(t=n.eventData={}),k(t),r={type:s.MASTER_PAGE_IMPRESSION,impressionGuid:n.impressionGuid?n.impressionGuid:_G.IG,previousImpressionGuid:null,timestamp:n.clientTimestamp,data:n},typeof EventsToDuplicate!="undefined"&&EventsToDuplicate&&(EventsToDuplicate.indexOf("ALL")>=0||EventsToDuplicate.indexOf("masterPageImpression")>=0)&&(u=ht("ImmediateMaster",t,n.impressionUrl,n.dataSources,n.layoutNodes,n.impressionGuid,null,null),ct([u])),o||!i.waitForPageInfo?w(r):et.push(JSON.stringify(r)))}function ui(n,t){for(var i,r,e,o,u=0,f=n;u<f.length;u++){i=f[u];r=t[i];try{e=JSON.parse(r);o=Object.keys(e);t[i]=o.length==0?fi(i,r)?ot:r:JSON.stringify(ui(o,e))}catch(s){t[i]=fi(i,r)?ot:r}}return t}function fi(n,t){return ai.indexOf(n)!=-1||!t||t===ot?!1:vi.indexOf(n)!=-1?!0:ki.some(function(n){return n.test(t)})}function ur(n,t){return typeof n!="undefined"?n:t}function ei(){return _G!==undefined&&_G.EF!==undefined&&_G.EF.logsb!==undefined&&_G.EF.logsb===1}function at(n,t){return(t===void 0&&(t=_G.XLS),!ei())?!1:oi(t,n)}function oi(n,t){var i="sendBeacon",r=!1;if(navigator&&navigator[i])try{r=navigator[i](n,t)}catch(u){}return r}function si(n,t){n===void 0&&(n=!0);r.dumpToStorage();gt(!0,n,t)}function g(){r.dumpToStorage();gt(!1)}function hi(){r.dumpToStorage(!0)}function vt(){r.dumpToStorage()}function ci(){p=null;_CachedFlights=undefined}var nt,r,c,ti,ii,ri,d;t.__esModule=!0;t.ResetState=t.SaveLogsToLocalStorage=t.SaveLogsToSharedStorage=t.FlushMainQueueDontForce=t.ForceFlush=t.Log2=t.LogInstrumented=t.Log=t.LogMasterPageImpression=t.LogEvent=void 0;var tt=n("env"),it=n("event.native"),h=n("event.custom"),e="Shared",s;(function(n){n[n.EVENT=0]="EVENT";n[n.MASTER_PAGE_IMPRESSION=1]="MASTER_PAGE_IMPRESSION"})(s||(s={}));var yt="MUID",p=null,rt="CIQueueError",i,li=864e5,ut,ft,f,et=[],o,v,pt,wt=0,ai=["Namespace"],vi=["chips","query","q","searchQuery","text","existingText","request","userId"],ot="<stripped/>",yi=new RegExp("\b[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:.[a-zA-Z0-9-]+)*\b"),pi=new RegExp("\b(query|q)=([w+]+)\b"),wi=new RegExp("(http|www).*(w+([+-]w+)+)+"),bi=new RegExp("www.bing.com/images/create/"),ki=[yi,pi,wi,bi],di=ur((nt=_w._sydConvConfig)===null||nt===void 0?void 0:nt.enableClientInstChatPrivacy,!1);(function(n){function k(){return c&&i.isInstrumentationEnabled}function d(n){var i,t;if(n===void 0&&(n=!1),k()){i=ct(n);try{t=n?v:h;f[t]=i;f[t+"_logUploadIntervalStartDate"]=o;f[t+"_uploadedLogSizeInInterval"]=r}catch(u){if(u.name.toLowerCase().indexOf("quota")>=0)c=!1;else throw u;}}}function y(){k()&&(a&&sb_ct(a),a=sb_st(d,i.queueDumpInterval))}function tt(n,t){var i=JSON.stringify(n),r=i.length+3;return n.size=r,t?i.replace('"size":0','"size":'+r):i}function it(n){return p===null&&typeof _CachedFlights!="undefined"&&_CachedFlights.sort&&(p=_CachedFlights.sort().join(",")),{log:n,lastSendErrorTimeStamp:0,inProgress:!1,size:0,flights:p}}function ut(){var n,r,i;if(f){if(at(),n=f[h],t=[],typeof n=="string"||n&&n.length!==0)try{if(t=JSON.parse(n),t.some(function(n){return!n.log}))u("PrimaryQueueRestoreInvalidItems",t.length,_G.IG),t=[];else if(r=t.length,r>0){for(i=0;i<r;i++)t[i].inProgress=!1;l()}}catch(e){u("PrimaryQueueRestoreFailed",0,_G.IG)}f[h]="[]";c=!0}}function ft(n){var a=[],y=[],o=n?e[0]:t,c,h,p,w,l,r,b;if(nt){if(c=f[v],typeof c=="string"&&c.length!==0)try{h=JSON.parse(c);h.some(function(n){return!n.log})?u("SharedQueueRestoreInvalidItems",h.length,_G.IG):o?Array.prototype.push.apply(o,h):o=h}catch(k){u("SharedQueueRestoreFailed",0,_G.IG)}f[v]="[]"}if(o)for(p=0,w=o.length,l=0;l<w;l++)if(r=o[l],n||!r.lastSendErrorTimeStamp)if(ClientInstConfig.enableBatSizeError&&r.size>i.maxBatchSize&&u("ElemBatchSizeLimitReached",r.size,_G.IG),p+=r.size,p<=i.maxBatchSize)r.inProgress=!0,b=r.log,b.type==s.MASTER_PAGE_IMPRESSION?y.push(r):a.push(r);else break;return{events:a,masterPageImpressions:y,length:a.length+y.length,isRetryBatch:n}}function et(n){return t=t.filter(function(t){return!t.inProgress&&(!n||!!t.lastSendErrorTimeStamp)}),y(),t.length>0}function ot(n){return n.log.type===s.EVENT&&n.log.data&&n.log.data.eventType===rt}function st(n,i){for(var f=[],h=i?e[0]:t,o=0,r,s,c;o<h.length;)r=h[o],r.inProgress?n?(h.splice(o,1),ot(r)||(r.lastSendErrorTimeStamp=(new Date).getTime(),f.push(r))):(r.inProgress=!1,o++):o++;s=f.length;s==1?u("InvalidLogMessage",1,f[0].log.impressionGuid):s>0&&(c=s/2,e.push(f.slice(0,c)),e.push(f.slice(c)));y()}function ht(){var n,t,i;if(e.length>0){for(n=e[0],t=0;t<n.length;)i=n[t],i.inProgress?n.splice(t,1):t++;n.length==0&&e.shift()}}function ct(n){var c=JSON.stringify(t),e=c.length-i.maxStorageUse,o=t.length,f,r,s,h;if(e>0)for(f=0,r=0;r<o;r++)if(s=t[r].size,f+=s+1,f>=e){t.splice(0,r+1);u("QueueOverflow",r+1,_G.IG,!0);break}return h=JSON.stringify(t),n&&t.splice(0,o),h}function lt(n){var r=it(n);tt(r,!1);ClientInstConfig.enableBatSizeError&&r.size>i.maxBatchSize&&u("EnvelopeBatchSizeLimitReached",r.size,_G.IG);vt(r.size)&&t.push(r);y()}function at(){var t=h+"_logUploadIntervalStartDate",u=h+"_uploadedLogSizeInInterval",n;o=f[t];r=f[u];n=sb_gt();o==undefined||r==undefined?w(n):g(o,n)>=i.logUploadCapIntervalInDays&&w(n)}function w(n){o=n;r=0}function g(n,t){var i=t-n;return i/li}function vt(n){var t,f;return i.isInstrumentationEnabled?LogUploadCapFeatureEnabled?(t=sb_gt(),g(o,t)>=i.logUploadCapIntervalInDays&&w(t),r>=i.logUploadCapSizeInChar)?!1:(f=r+n,f>=i.logUploadCapSizeInChar)?(u("LogUploadSizeLimitReached",1,_G.IG,!0),r=i.logUploadCapSizeInChar,!1):(r=f,!0):!0:!1}var t=[],o,r,c=!1,a=null,e=[],b=_w.location.pathname,h=InstLogQueueKeyFetcher.Get(b),v=InstLogQueueKeyFetcher.GetSharedLocation(),nt=InstLogQueueKeyFetcher.CanUploadSharedMessages(b);n.dumpToStorage=d;n.initialize=ut;n.getBatch=ft;n.clearSentItems=et;n.markFailedItems=st;n.recordRetryAttempt=ht;n.append=lt})(r||(r={}));c={mainQueue:{getInterval:function(){return i.flushInterval}},retryQueue:{getInterval:function(){return i.retryInterval}}};t.LogEvent=lt;t.LogMasterPageImpression=ni;ti=function(n,t,r,u){for(var e=[],f=4;f<arguments.length;f++)e[f-4]=arguments[f];i.isInstrumentationEnabled&&(pt||(d("Init","CI","Base"),pt=!0),d(n,t,r,u,e))};t.Log=ti;ii=function(n,i,r,u,f,e,o){t.Log2(n,i!==null&&i!==void 0?i:r,null,null,u,f,o)};t.LogInstrumented=ii;ri=function(n,t,i,r,u,f,e){var o=Object.keys(e).reduce(function(n,t){return __spreadArray(__spreadArray([],n,!0),[t,e[t]],!1)},[]);i&&o.push("service",i);r&&o.push("scenario",r);u&&o.push("appNS",u);f&&o.push("kValue",f);d(n,null,t,!1,o)};t.Log2=ri;d=function(n,t,r,u,f){var c,l,o,h,a;if(i.isInstrumentationEnabled){var v=_G.IG,e={},y=[];if(f&&f.length>0&&f.length%2==0)for(c=0;c<f.length;c+=2)(l=f[c],l)&&(o=l.toLowerCase(),h=f[c+1],o==="impressionguid"?v=h:o==="service"?e.Service=h:o==="scenario"?e.Scenario=h:o==="appns"?e.AppNS=h:o==="k"||o==="kvalue"?e.K=h:o==="pos"?e.Pos=h:(y.push(l),e[l]=h));t==="Codex"&&di&&ui(y,e);a=(new Date).getTime();e.T="CI.".concat(n);e.TS=a;e.RTS=a-ft;e.SEQ=ut++;e.Name=r!==null&&r!==void 0?r:"";e.FID=typeof t!="number"?t!==null&&t!==void 0?t:"":"";e.hasOwnProperty("K")||typeof t!="number"||(e.K=t);k(e);w({type:s.EVENT,impressionGuid:v,previousImpressionGuid:null,timestamp:a,data:{eventType:"ClientInst",eventData:e}})}};t.ForceFlush=si;nr();t.FlushMainQueueDontForce=g;t.SaveLogsToSharedStorage=hi;t.SaveLogsToLocalStorage=vt;t.ResetState=ci;typeof h!="undefined"&&h.bind&&(h.bind("onP1",g,!0),h.bind("ajax.postload",g,!0));typeof it!="undefined"&&it.bind&&it.bind(_w,"beforeunload",vt,!1);_w.Log={Log:t.Log};_w.Log2={LogEvent:lt,LogMasterPageImpression:ni,ForceFlush:si,FlushMainQueueDontForce:g,SaveLogsToSharedStorage:hi,ResetState:ci,SaveLogsToLocalStorage:vt};_w.Shared2=_w.Shared2||{};_w.Shared2.Log={Log:t.Log,LogInstrumented:t.LogInstrumented};_w.sj_log2=t.Log2})